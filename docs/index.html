<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://kit.fontawesome.com/877e197de7.js"
      crossorigin="anonymous"
    ></script>
    <script src="constantes.js"></script>
    <style>
.container {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    height: 100vh;
  }

  .info {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 10px;
    padding: 40px;
  }
  
  .buttons {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-content: center;
  }
  
  button {
    font-size: 1.2rem;
    font-weight: 600;
    border: 2px solid #000;
    margin: 10px auto;
    width: 200px;
  }
  
  .confirmar {
    background-color: green;
  }
  
  .cancelar {
    background-color: red;
  }
  
  .branco {
    background-color: #fff;
  }
  
  .options {
    background-color: #a8a1a1;
    padding: 12px;
    width: 250px;
    margin: 60px 0;
    border-radius: 10px;
  }
  
  input, input:disabled {
    text-align: center;
    color: #444;
    cursor: not-allowed;
    outline: 3px solid #444 ;
    font-size: 2rem;
    font-weight: 600;
    padding: 6px;
    height: 2rem;
    width: 200px;
    margin: auto;
  }
  
  p {
    text-align: center;
  }
  
  label {
    font-weight: 600;
    font-size: large;
  }
    </style>
  </head>
  <body>
    <div class="container">
      
        <div class="info">
          
          <label for="inputVoto">Digite a chapa que deseja votar</label>
          
          <input
            id="inputVoto"
            name="inputVoto"
            type="text"
            onclick="preventInputFocus(this)"
            disabled
            maxlength="2"
          />
          <p id="votoCancelado" style="display: none; font-weight: bold;"><span style="color: rgb(128, 0, 0)">Voto cancelado! Reiniciando urna...</span></p>
          <p id="notFound" style="display: none; font-weight: bold;"><span style="color: rgb(128, 0, 0)">Candidato não encontrado.</span></p>
        </div>
  
        <div id="buttons" class="buttons">
          <button onclick="enviarNumeroChapa()" class="confirmar">
            Confirmar voto
          </button>
          <button onclick="votarBranco()" class="branco">Votar branco</button>
          <button onclick="cancelarVoto()" class="cancelar">Cancelar voto</button>

          
        </div>
  
        <div id="options" class="options">
          <p><span style="color: green">Verde</span> para confirmar</p>
          <p><span style="color: white">Branco</span> para votar em branco</p>
          <p><span style="color: rgb(170, 46, 46)">Vermelho</span> para limpar a tela</p>
        </div>

    <script>
      const NUMERICOS = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];

      const inputVoto = document.getElementById("inputVoto");

      // Funções
      function inserirNumero(numero) {
        inputVoto.value = inputVoto.value + numero;
      }

      function votarBranco() {
        const url = "confirmar.html?numero=BRANCO";
        window.location.href = url;
      }

      function candidatoNotFound() {
        var minhaDiv = document.getElementById("notFound");
            setTimeout(function() {
              minhaDiv.style.display = "block";
            }, 1000);
            setTimeout(function() {
              minhaDiv.style.display = "none";
            }, 3000);
      }

      function confirmarVoto() {
        function enviarNumeroChapa(chapa) {
          const n_chapInput = document.getElementById("inputVoto");
          const numeroChapa = n_chapInput.value;
          const Stringchapa = numeroChapa.toString();
          console.log(Stringchapa);
          const url = `${BaseUrlMesario}/candidato/${chapa}`;
          const data = JSON.stringify({
            chapa: Stringchapa,
          });
          const urlVoto = `confirmar.html?numero=${encodeURIComponent(
            numeroChapa
          )}`;

          fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: data,
          })
            .then((response) => response.json())
            .then((eleitor) => {
              console.log(eleitor);
              if (eleitor.chapa !== Stringchapa) {
                candidatoNotFound()
              } else {
                window.location.href = urlVoto;
              }
            });
        }
        enviarNumeroChapa();
      }

      function mostrarConteudo() {
            var minhaDiv = document.getElementById("votoCancelado");
            var buttons = document.getElementById("buttons")
            var options = document.getElementById("options")
            

            setTimeout(function() {
              minhaDiv.style.display = "block";
              buttons.style.display = "none"
              options.style.display = "none"
            }, 1000);
            setTimeout(function() {
              minhaDiv.style.display = "none";
              buttons.style.display = "flex"
              options.style.display = "block"
            }, 3000);
            
        }

      function cancelarVoto() {
        votarBranco();

      }


      function limpaTudo() {
        inputVoto.value = "";
      }

      // Event Listener
      document.addEventListener("keydown", (event) => {
        // Cria um Event Listener para capturar todas as teclas pressionadas

        const tecla = event.key; // Captura a tecla clicada
        // Use o alert comentado abaixo para descobrir o nome das teclas quando clicadas.
        // alert('Tecla clicada\n\n' + 'key: ' + tecla);

        event.preventDefault(); // Importante para previnir que a tecla clicada tenha seu comportamento padrão. Isto é, ao clicar tab, o navegador não irá 'focar' o próximo elemento.

        if (NUMERICOS.includes(tecla)) {
          inserirNumero(tecla);
        }

        if (tecla == "+") {
          votarBranco();
          limpaTudo();
          return;
        }

        if (tecla == "Enter") {
          confirmarVoto();
          limpaTudo();
          return;
        }

        if (tecla == "Delete") {

          limpaTudo();
          return;
        }

        if (tecla == "Backspace") {
          limpaTudo();
          return;
        }
      });

      function verificarUrnaLiberada() {
        fetch(`${BaseUrlEleitor}/eleitor/verificar/${ra}`, {
          method: "POST",
        })
          .then((response) => response.json())

          .then((data) => {
            let urnaLiberada = data;
            console.log(urnaLiberada);
            setTimeout(verificarUrnaLiberada, 2000);

            if (urnaLiberada === false) {
              window.location.href = "index.html";
            }
          })
          .catch((err) => {
            console.error(err);
          });
      }
      verificarUrnaLiberada();
    </script>
  </body>
</html>
